<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SkyCam · Lovelace</title>
<style>
:root{
  --bg:#070b14; --panel:#0f1b33; --panel2:#0b152b; --border:#1f2f52;
  --text:#e8f0ff; --muted:#9fb3d6; --link:#7aa2ff;
  --good:#6ee7b7; --warn:#fbbf24; --bad:#fb7185;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
  background:radial-gradient(1000px 600px at 25% 0%, #0c1630 0%, var(--bg) 65%);
  color:var(--text);
}
.wrap{max-width:1500px;margin:0 auto;padding:18px}
.top{display:flex;gap:14px;align-items:flex-start;justify-content:space-between;margin-bottom:14px}
h1{margin:0;font-size:18px;letter-spacing:.2px}
.sub{color:var(--muted);font-size:13px;margin-top:3px}
.nav{display:flex;gap:10px;flex-wrap:wrap}
.nav a{
  color:var(--link);text-decoration:none;font-size:13px;
  border:1px solid var(--border);padding:6px 10px;border-radius:10px;
  background:rgba(15,27,51,.4);
}
.grid{display:grid;grid-template-columns:1.35fr .65fr;gap:14px}
.card{
  background:linear-gradient(180deg, rgba(15,27,51,.9), rgba(11,21,43,.9));
  border:1px solid var(--border);border-radius:16px;padding:12px;
}
.card h2{margin:0 0 8px 0;font-size:14px;color:var(--muted);font-weight:600}
.imgwrap{border-radius:14px;overflow:hidden;border:1px solid var(--border);background:#000}
img{width:100%;height:auto;display:block}
.small{font-size:12px;color:var(--muted)}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-top:10px}
.badge{font-size:12px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
.badge.good{border-color:rgba(110,231,183,.35);color:var(--good)}
.badge.warn{border-color:rgba(251,191,36,.35);color:var(--warn)}
.badge.bad{border-color:rgba(251,113,133,.35);color:var(--bad)}
.kpi{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.tile{border:1px solid var(--border);border-radius:14px;padding:10px;background:rgba(8,16,32,.55)}
.tile .label{font-size:12px;color:var(--muted)}
.tile .val{font-size:20px;margin-top:4px}
.mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
hr{border:0;border-top:1px solid var(--border);margin:12px 0}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <h1>SkyCam</h1>
      <div class="sub">Lovelace · Still + MJPEG stream + weather</div>
    </div>
    <div class="nav">
      <a href="/skycam/latest_full.jpg" target="_blank" rel="noopener">Still (full)</a>
      <a href="/skycam/latest.jpg" target="_blank" rel="noopener">Still (web)</a>
      <a href="/skycam/stream" target="_blank" rel="noopener">Stream</a>
      <a href="/skycam/forecast.json" target="_blank" rel="noopener">forecast.json</a>
      <a href="http://10.0.0.100/" target="_blank" rel="noopener">Landing</a>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <h2>Latest still image</h2>
      <div class="imgwrap">
        <img id="still" alt="SkyCam still" src="/skycam/latest_full.jpg"/>
      </div>
      <div class="row">
        <div class="small">Auto-refresh: 5s · Cache disabled</div>
        <div id="stillStatus" class="badge warn">checking…</div>
      </div>
    </div>

    <div class="card">
      <h2>Weather</h2>
      <div class="kpi">
        <div class="tile">
          <div class="label">Temperature</div>
          <div class="val"><span id="t">—</span> <span class="small">°C</span></div>
        </div>
        <div class="tile">
          <div class="label">Humidity</div>
          <div class="val"><span id="rh">—</span> <span class="small">%</span></div>
        </div>
        <div class="tile">
          <div class="label">Dew point</div>
          <div class="val"><span id="dew">—</span> <span class="small">°C</span></div>
        </div>
        <div class="tile">
          <div class="label">Last update (UTC)</div>
          <div class="val mono" style="font-size:13px;margin-top:6px" id="ts">—</div>
        </div>
      </div>

      <hr/>

      <div class="row">
        <div class="small">Source: <span id="src" class="mono">—</span></div>
        <div id="wxStatus" class="badge warn">loading…</div>
      </div>

      <div class="small" style="margin-top:10px">
        Update helper: <span class="mono">/usr/local/bin/skycam_weather_update.sh</span>
      </div>
    </div>
  </div>
</div>

<script>
const $ = (id)=>document.getElementById(id);

function setBadge(el, state, text){
  el.classList.remove("good","warn","bad");
  el.classList.add(state);
  el.textContent = text;
}

function refreshStill(){
  const url = "/skycam/latest_full.jpg?t=" + Date.now();
  const img = $("still");
  const st = $("stillStatus");
  setBadge(st, "warn", "loading…");
  img.onload = ()=>setBadge(st, "good", "OK");
  img.onerror = ()=>setBadge(st, "bad", "image missing");
  img.src = url;
}

async function loadForecast(){
  const st = $("wxStatus");
  setBadge(st, "warn", "loading…");
  try{
    const r = await fetch("/skycam/forecast.json?t="+Date.now(), {cache:"no-store"});
    if(!r.ok) throw new Error("HTTP "+r.status);
    const j = await r.json();
    $("t").textContent   = (j.temperature_c ?? "—");
    $("rh").textContent  = (j.humidity_pct ?? "—");
    $("dew").textContent = (j.dewpoint_c ?? "—");
    $("ts").textContent  = (j.generated_utc ?? "—");
    $("src").textContent = (j.source ?? "—");
    setBadge(st, "good", "OK");
  }catch(e){
    setBadge(st, "bad", "error");
  }
}

refreshStill();
loadForecast();
setInterval(refreshStill, 5000);
setInterval(loadForecast, 15000);
</script>
</body>
</html>
