<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SkyCam · Observatory</title>

<style>
:root{
  --bg:#070b14;
  --panel:#0f1b33;
  --panel2:#0b152b;
  --border:#1f2f52;
  --text:#e8f0ff;
  --muted:#9fb3d6;
  --good:#6ee7b7;
  --bad:#fb7185;
  --warn:#fbbf24;
  --link:#7aa2ff;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
  background:radial-gradient(1000px 600px at 25% 0%, #0c1630 0%, var(--bg) 65%);
  color:var(--text);
}
.wrap{max-width:1500px;margin:0 auto;padding:18px}
.top{
  display:flex; gap:14px; align-items:center; justify-content:space-between;
  margin-bottom:14px;
}
.brand{display:flex;flex-direction:column;gap:2px}
h1{margin:0;font-size:18px;letter-spacing:.2px}
.sub{color:var(--muted);font-size:13px}
.nav{display:flex;gap:10px;flex-wrap:wrap}
.nav a{
  color:var(--link); text-decoration:none; font-size:13px;
  border:1px solid var(--border); padding:6px 10px; border-radius:10px;
  background:rgba(15,27,51,.4);
}
.grid{display:grid;grid-template-columns:1.25fr .75fr;gap:14px}
@media (max-width: 980px){ .grid{grid-template-columns:1fr} }

.card{
  background:linear-gradient(180deg,var(--panel) 0%, var(--panel2) 100%);
  border:1px solid var(--border);
  border-radius:18px;
  padding:14px;
  box-shadow:0 10px 30px rgba(0,0,0,.35);
}
.card h2{margin:0 0 10px 0;font-size:14px;color:var(--muted);font-weight:600}
.row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.kv{display:grid;grid-template-columns:140px 1fr;gap:6px 12px;font-size:13px}
.kv b{color:var(--muted);font-weight:600}
.pill{
  display:inline-flex; align-items:center; gap:8px;
  padding:6px 10px; border-radius:999px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.18);
  font-size:12px;
}
.dot{width:8px;height:8px;border-radius:999px;background:var(--warn)}
.ok .dot{background:var(--good)}
.bad .dot{background:var(--bad)}
code{color:#cfe0ff}
img{
  width:100%;
  border-radius:14px;
  border:1px solid var(--border);
  background:#000;
  display:block;
}
.small{font-size:12px;color:var(--muted)}
pre{
  margin:0;
  padding:10px;
  border-radius:14px;
  border:1px solid var(--border);
  background:rgba(0,0,0,.25);
  color:var(--muted);
  font-size:12px;
  overflow:auto;
  max-height:420px;
}
hr{border:0;border-top:1px solid var(--border);margin:12px 0}
.err{
  margin-top:10px;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(251,113,133,.35);
  background:rgba(251,113,133,.08);
  color:#ffd3dc;
  font-size:12px;
  display:none;
}
</style>
</head>

<body>
<div class="wrap">

  <div class="top">
    <div class="brand">
      <h1>SkyCam · Observatory</h1>
      <div class="sub">10.0.0.100 · Still + MJPEG stream · local lab dashboard</div>
    </div>
    <div class="nav">
      <a href="/skycam/latest_full.jpg" target="_blank" rel="noopener">Open Still (full)</a>
      <a href="/skycam/latest.jpg" target="_blank" rel="noopener">Open Still (web)</a>
      <a href="/skycam/stream" target="_blank" rel="noopener">Open Stream</a>
      <a href="/" target="_blank" rel="noopener">Back to Landing</a>
    </div>
  </div>

  <div class="grid">

    <div class="card">
      <h2>Latest still image</h2>

      <div class="row" style="margin-bottom:10px">
        <span id="pillStill" class="pill"><span class="dot"></span><span id="stillState">Checking…</span></span>
        <span class="pill"><b style="color:var(--muted)">Auto refresh</b>&nbsp;5s</span>
        <span class="pill"><b style="color:var(--muted)">Last modified</b>&nbsp;<span id="lm">—</span></span>
        <span class="pill"><b style="color:var(--muted)">Size</b>&nbsp;<span id="sz">—</span></span>
      </div>

      <img id="still" src="/skycam/latest_full.jpg" alt="SkyCam still">

      <div class="err" id="stillErr"></div>
      <div class="small" style="margin-top:10px">
        Tip: If you see a black frame, the pipeline is working but the camera upload may not have started yet (FTP path / credentials).
      </div>
    </div>

    <div class="card">
      <h2>System and data</h2>

      <div class="row" style="margin-bottom:10px">
        <span id="pillStream" class="pill"><span class="dot"></span><span id="streamState">Checking stream…</span></span>
        <span class="pill"><b style="color:var(--muted)">Endpoint</b>&nbsp;<code>/skycam/stream</code></span>
      </div>

      <div class="small">Forecast JSON</div>
      <pre id="forecast">(loading…)</pre>

      <hr>

      <div class="small">Endpoints</div>
      <pre id="eps">/skycam/ (this page)
 /skycam/latest_full.jpg
 /skycam/latest.jpg
 /skycam/forecast.json
 /skycam/stream</pre>
    </div>

  </div>
</div>

<script>
const still = document.getElementById("still");
const pillStill = document.getElementById("pillStill");
const pillStream = document.getElementById("pillStream");
const stillErr = document.getElementById("stillErr");
const lm = document.getElementById("lm");
const sz = document.getElementById("sz");

function setPill(pill, ok, text){
  pill.classList.remove("ok","bad");
  pill.classList.add(ok ? "ok" : "bad");
  pill.querySelector("span:last-child").textContent = text;
}

async function headStill(){
  try{
    const r = await fetch("/skycam/latest_full.jpg", { method:"HEAD", cache:"no-store" });
    if(!r.ok) throw new Error("HTTP "+r.status);
    lm.textContent = r.headers.get("last-modified") || "—";
    sz.textContent = (r.headers.get("content-length") || "—") + " bytes";
    setPill(pillStill, true, "Still ONLINE");
    stillErr.style.display="none";
  }catch(e){
    setPill(pillStill, false, "Still OFFLINE");
    stillErr.style.display="block";
    stillErr.textContent = "Still error: " + e;
  }
}

async function probeStream(){
  try{
    await fetch("/skycam/stream", { method:"GET", cache:"no-store", signal: AbortSignal.timeout(1200) });
    setPill(pillStream, true, "Stream ONLINE");
  }catch(e){
    setPill(pillStream, false, "Stream OFFLINE");
  }
}

async function loadForecast(){
  try{
    const r = await fetch("/skycam/forecast.json?t="+Date.now(), { cache:"no-store" });
    if(!r.ok) throw new Error("HTTP "+r.status);
    document.getElementById("forecast").textContent = JSON.stringify(await r.json(), null, 2);
  }catch(e){
    document.getElementById("forecast").textContent = "No forecast.json";
  }
}

function refreshStill(){
  still.src = "/skycam/latest_full.jpg?t=" + Date.now();
}

still.addEventListener("error", () => {
  stillErr.style.display="block";
  stillErr.textContent = "Browser could not render still image. (File missing or invalid JPEG.)";
});

headStill(); probeStream(); loadForecast();
setInterval(refreshStill, 5000);
setInterval(headStill, 10000);
setInterval(probeStream, 15000);
setInterval(loadForecast, 20000);
</script>
</body>
</html>
